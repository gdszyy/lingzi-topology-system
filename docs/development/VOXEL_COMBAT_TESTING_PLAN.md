# 二维体素战斗系统 - 测试计划

**版本:** 1.0
**日期:** 2026-01-12
**作者:** Manus AI

## 1. 概述

本文档为“二维体素战斗系统”的功能验证提供了一套全面的测试用例。该计划旨在确保所有核心功能，包括肢体目标伤害、肢体摧毁、法术失效、状态反馈及游戏性影响，都能按预期正常工作。

测试将主要通过新创建的 `scenes/test/voxel_combat_test.tscn` 场景进行。

## 2. 测试环境

- **场景:** `scenes/test/voxel_combat_test.tscn`
- **核心脚本:** `scenes/test/voxel_combat_test.gd`
- **被测对象:** `PlayerController` 和 `Enemy` 实例，及其关联的 `EngravingManager` 和 `BodyPartData`。

## 3. 测试用例

### 3.1. 肢体伤害与摧毁测试

| 测试用例 ID | 测试描述 | 操作步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| VCT-001 | **攻击特定肢体:** 验证对敌人特定肢体的伤害是否生效。 | 1. 运行测试场景。<br>2. 按下键盘 `2` 键，攻击敌人的“右臂”。 | 1. 日志输出“玩家攻击敌人的右臂...”。<br>2. 敌人状态UI中，“右臂”的生命值下降。<br>3. 敌人的总能量上限（核心生命值）按 `core_damage_ratio` 的比例下降。 |
| VCT-002 | **摧毁非关键肢体:** 验证摧毁敌人手臂是否成功。 | 1. 运行测试场景。<br>2. 多次按下键盘 `2` 键，持续攻击敌人“右臂”直至其生命值降为零。 | 1. 日志输出“[敌人肢体摧毁] 敌人的右臂已被摧毁！”。<br>2. 敌人状态UI中，“右臂”状态变为“摧毁”。<br>3. 再次攻击右臂时，伤害将直接传递给躯干。 |
| VCT-003 | **摧毁关键肢体:** 验证摧毁敌人躯干是否导致其死亡。 | 1. 运行测试场景。<br>2. 多次按下键盘 `1` 键，持续攻击敌人“躯干”直至其生命值降为零。 | 1. 日志输出“[敌人肢体摧毁] 敌人的躯干已被摧毁！”。<br>2. 敌人因为关键部位被摧毁而死亡，从场景中消失。 |
| VCT-004 | **肢体恢复:** 验证肢体恢复功能是否正常。 | 1. 先执行 VCT-002，摧毁敌人右臂。<br>2. 按下键盘 `4` 键。 | 1. 日志输出“恢复敌人所有肢体...”。<br>2. 敌人状态UI中，所有肢体的生命值恢复到最大值，状态变为“健康”。 |

### 3.2. 法术失效与效率测试

| 测试用例 ID | 测试描述 | 操作步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| VCT-005 | **功能正常时触发法术:** 验证功能完好的肢体可以正常触发篆刻法术。 | 1. 运行测试场景。<br>2. 按下键盘 `5` 键。 | 1. 日志输出“尝试触发玩家右臂的法术...”。<br>2. 日志输出“[刻录触发] ...”信息，表示法术被成功触发。<br>3. 敌人受到法术造成的25点伤害。 |
| VCT-006 | **肢体摧毁后法术失效:** 验证被摧毁的肢体无法触发法术。 | 1. 模拟玩家右臂被摧毁：在 `voxel_combat_test.gd` 的 `_ready` 函数中添加 `player.get_body_part(BodyPartData.PartType.RIGHT_ARM).take_damage(999)`。<br>2. 运行测试场景。<br>3. 按下键盘 `5` 键。 | 1. 日志输出“尝试触发玩家右臂的法术...”。<br>2. **没有**“[刻录触发]”信息输出。<br>3. 敌人**不会**受到伤害。 |
| VCT-007 | **肢体损伤影响效率 (待实现):** 验证肢体受损状态会降低法术效果。 | 1. 模拟玩家右臂受损：`player.get_body_part(BodyPartData.PartType.RIGHT_ARM).take_damage(50)`。<br>2. 按下键盘 `5` 键。 | 1. 法术被触发。<br>2. 敌人受到的伤害应低于25点（例如，25 * 0.75 = 18.75），因为肢体效率下降。 |

### 3.3. 游戏性影响测试

| 测试用例 ID | 测试描述 | 操作步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| VCT-008 | **腿部摧毁影响移动:** 验证玩家腿部被摧毁后移动速度和飞行能力受限。 | 1. 模拟玩家腿部被摧毁：`player.get_body_part(BodyPartData.PartType.LEGS).take_damage(999)`。<br>2. 运行测试场景。<br>3. 按下 `W/A/S/D` 键移动，按下 `空格键` 尝试飞行。 | 1. 玩家移动速度明显变慢（降低70%）。<br>2. 玩家无法进入飞行状态。 |
| VCT-009 | **手臂摧毁影响攻击 (待实现):** 验证手臂被摧毁后无法使用武器。 | 1. 模拟玩家右臂被摧毁。<br>2. 尝试执行攻击动作。 | 1. 玩家无法执行攻击动作。<br>2. UI提示“右臂已摧毁，无法攻击”。 |

## 4. 测试执行与报告

- 测试人员将按照上述用例逐一执行测试。
- 任何与预期结果不符的情况都将被记录为缺陷（Bug），并提交给开发团队进行修复。
- 所有测试完成后，将生成一份详细的测试报告，总结测试结果和发现的问题。
