# 攻击动画优化测试指南

## 快速开始

### 1. 基础测试 - 观察双手动作

在游戏中执行不同的攻击，观察以下内容：

#### 挥砍攻击 (Slash)
- ✓ 右手挥舞武器，做出弧形动作
- ✓ 左手做平衡动作（单手武器）
- ✓ 身体轻微旋转跟随武器
- ✓ 恢复时双手平滑回到待机位置

#### 刺击攻击 (Thrust)
- ✓ 右手快速向前刺出
- ✓ 身体前倾增加力度感
- ✓ 左手向后平衡
- ✓ 收回时身体恢复平衡

#### 重击攻击 (Smash)
- ✓ 武器高举过头
- ✓ 快速砸下，挥舞范围最大
- ✓ 左手也做出用力动作（双手武器）或辅助（单手）
- ✓ 恢复时缓慢放下

#### 横扫攻击 (Sweep)
- ✓ 大范围的水平挥舞
- ✓ 身体大幅转动
- ✓ 左手做大幅平衡动作

### 2. 武器挥舞效果测试

观察武器的视觉效果：

#### 武器拖尾
- 在快速挥舞时，武器后面应该有拖尾效果
- 拖尾应该逐渐消失
- 可以通过 `weapon_trail_enabled` 参数启用/禁用

#### 武器缩放
- 挥舞时武器可能会略微放大（如果启用）
- 恢复时缩放回正常大小

#### 武器发光
- 如果 `weapon_glow_intensity > 0`，武器在挥舞时会发光
- 发光强度随动画进度变化

### 3. 性能测试

#### 单个角色攻击
- 帧率应该保持稳定（60+ FPS）
- 没有明显的卡顿

#### 多个角色同时攻击
- 3-5 个角色同时攻击时帧率应该 > 30 FPS
- 武器拖尾不应该造成显著的性能下降

### 4. 配置调整测试

在 Godot 编辑器中调整以下参数观察效果：

#### CombatAnimator 参数
```
# 影响攻击速度和幅度
- 增加 swing_momentum_multiplier 使攻击更有力
- 减少 ik_smoothing 使手臂反应更快
```

#### WeaponPhysics 参数
```
# 影响武器物理反应
- 增加 rotation_stiffness 使武器更快回正
- 增加 rotation_damping 使武器摆动更稳定
- 调整 max_angular_velocity 限制最大转速
```

#### ArmRig 参数
```
# 影响视觉效果
- 调整 weapon_scale_on_swing 改变缩放幅度
- 调整 weapon_glow_intensity 改变发光强度
- weapon_trail_enabled 启用/禁用拖尾
```

## 调试技巧

### 1. 启用调试可视化

在 CombatAnimator 中添加调试代码：

```gdscript
func _update_attack_visuals() -> void:
    # 在 _process 中添加调试绘制
    if is_animating:
        # 绘制手臂目标位置
        # 绘制武器轨迹
        # 显示当前阶段信息
```

### 2. 检查动画阶段

```gdscript
# 在 _process 中打印信息
print("Phase: %d, Progress: %.2f" % [animation_phase, animation_progress])
```

### 3. 验证左手动作

- 在单手武器攻击时，左手应该做出平衡动作
- 在双手武器攻击时，左手应该握在武器上
- 可以通过调整 `left_arm.set_hand_target()` 的参数来调试

## 常见问题排查

### 问题 1: 左手没有动作
**原因**: 可能是 `_update_left_hand_for_*` 函数没有被调用
**解决**: 检查 `_update_attack_visuals()` 中是否调用了相应的左手更新函数

### 问题 2: 武器挥舞不够快
**原因**: 物理参数设置过于阻尼
**解决**: 
- 增加 `rotation_stiffness`
- 减少 `rotation_damping`
- 增加 `swing_momentum_multiplier`

### 问题 3: 武器拖尾不显示
**原因**: 
- `weapon_trail_enabled` 为 false
- 武器速度不足 50
- 拖尾线没有正确初始化
**解决**: 检查 ArmRig 中的 `_update_weapon_trail()` 函数

### 问题 4: 性能下降
**原因**: 
- 武器拖尾点过多
- 物理计算过于复杂
**解决**: 
- 减少 `weapon_trail_max_points`
- 简化物理参数

## 对比测试

### 优化前 vs 优化后

| 方面 | 优化前 | 优化后 |
|------|--------|--------|
| 左手 | 静止不动 | 做平衡/协助动作 |
| 武器挥舞 | 基础旋转 | 增加伸出距离和动量 |
| 视觉效果 | 无 | 拖尾、缩放、发光 |
| 动画流畅性 | 基础 | 使用缓动函数 |
| 攻击感觉 | 一般 | 更有力度和冲击感 |

## 提交反馈

测试后如果发现问题或有改进建议，请记录：

1. **问题描述**: 具体现象
2. **复现步骤**: 如何重现
3. **期望结果**: 应该如何表现
4. **实际结果**: 实际是什么样的
5. **环境信息**: Godot 版本、系统等

## 下一步优化方向

- [ ] 添加更多攻击类型（如下劈、上挑）
- [ ] 支持连击时的手臂过渡动画
- [ ] 根据角色属性动态调整动画速度
- [ ] 添加武器特效（魔法、元素等）
- [ ] 支持多武器组合的协调动作

---

**最后更新**: 2026-01-13
**维护者**: AI Assistant
