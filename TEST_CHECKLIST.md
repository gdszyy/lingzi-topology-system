# 攻击移动修复测试清单

## 代码验证 ✅

### 1. 攻击状态修改验证
- [x] `attack_windup_state.gd`: `can_move = true` ✅
- [x] `attack_active_state.gd`: `can_move = true` ✅
- [x] `attack_recovery_state.gd`: `can_move = true` ✅

### 2. 移动速度惩罚验证
- [x] `player_controller.gd`: 添加了攻击时的速度惩罚逻辑 ✅
- [x] 速度降低 40% (max_speed *= 0.6) ✅
- [x] 加速度降低 30% (acceleration *= 0.7) ✅

### 3. 代码语法检查
- [x] 所有修改文件的缩进正确 ✅
- [x] 没有语法错误 ✅
- [x] 注释清晰标注了修改位置 ✅

## 功能测试建议

### 基础功能测试
- [ ] **测试 1**: 站立攻击时可以移动
  - 操作：站立不动，按攻击键，同时按方向键
  - 预期：角色可以边攻击边移动，速度比正常移动慢

- [ ] **测试 2**: 移动中攻击不会停止移动
  - 操作：移动中按攻击键
  - 预期：角色继续移动，同时播放攻击动画

- [ ] **测试 3**: 连击过程中可以持续移动
  - 操作：连续按攻击键进行连击，同时按方向键
  - 预期：整个连击过程中都可以移动

### 速度测试
- [ ] **测试 4**: 攻击时移动速度确实降低
  - 操作：对比正常移动和攻击移动的速度
  - 预期：攻击时移动速度明显慢于正常移动

- [ ] **测试 5**: 攻击结束后速度恢复
  - 操作：攻击后立即移动
  - 预期：速度恢复到正常水平

### 不同武器测试
- [ ] **测试 6**: 长剑攻击移动
  - 预期：可以边挥舞长剑边移动

- [ ] **测试 7**: 短剑攻击移动
  - 预期：可以边刺击边移动

- [ ] **测试 8**: 长枪攻击移动
  - 预期：可以边舞枪边移动

- [ ] **测试 9**: 匕首攻击移动
  - 预期：可以边快速攻击边移动

- [ ] **测试 10**: 法杖攻击移动
  - 预期：可以边攻击边移动

### 特殊状态测试
- [ ] **测试 11**: 飞行状态下攻击移动
  - 操作：飞行时攻击并移动
  - 预期：可以边飞行边攻击边移动

- [ ] **测试 12**: 肢体损伤时攻击移动
  - 操作：腿部受损后攻击移动
  - 预期：速度受到双重惩罚（肢体损伤 + 攻击惩罚）

- [ ] **测试 13**: 不同方向攻击移动
  - 操作：向前、向后、向左、向右攻击移动
  - 预期：所有方向都可以正常移动

### 战斗体验测试
- [ ] **测试 14**: 边攻击边追击敌人
  - 操作：攻击移动的敌人
  - 预期：可以边攻击边跟随敌人

- [ ] **测试 15**: 边攻击边躲避攻击
  - 操作：攻击时躲避敌人的攻击
  - 预期：可以边攻击边走位躲避

- [ ] **测试 16**: 攻击时调整位置
  - 操作：攻击时微调位置以命中敌人
  - 预期：可以通过移动调整攻击位置

## 性能测试
- [ ] **测试 17**: 大量敌人时攻击移动
  - 操作：在多个敌人中边攻击边移动
  - 预期：性能正常，无卡顿

## 边界情况测试
- [ ] **测试 18**: 攻击时撞墙
  - 操作：攻击时移动到墙边
  - 预期：正常碰撞，不会穿墙

- [ ] **测试 19**: 攻击时切换武器
  - 操作：攻击过程中切换武器
  - 预期：行为符合预期（根据游戏设计）

- [ ] **测试 20**: 攻击时施放法术
  - 操作：攻击时尝试施放法术
  - 预期：行为符合预期（根据游戏设计）

## 回归测试
- [ ] **测试 21**: 其他状态的移动功能正常
  - 测试：Idle、Move、Fly、Turn 等状态
  - 预期：所有状态的移动功能都正常

- [ ] **测试 22**: 攻击判定正常
  - 测试：攻击是否能正常命中敌人
  - 预期：命中判定不受移动影响

- [ ] **测试 23**: 攻击动画正常
  - 测试：攻击动画是否正常播放
  - 预期：动画播放流畅，不受移动影响

## 已知限制
- 攻击时旋转仍然被禁用（`can_rotate = false`），这是设计决策
- 前摇和激活阶段不允许旋转，恢复阶段允许旋转

## 后续优化方向
1. 根据武器类型调整移动速度惩罚
2. 根据攻击阶段调整移动速度惩罚
3. 添加可配置的惩罚参数
4. 考虑添加攻击移动的特殊动画

## 测试环境
- Godot 版本：4.5
- 项目：lingzi-topology-system
- 测试场景：`scenes/battle_test/battle_test_scene.tscn`

## 测试说明
由于这是一个 Godot 项目，需要在 Godot 编辑器中运行项目进行实际测试。上述测试清单提供了完整的测试指南，但实际执行需要在游戏运行时进行。
